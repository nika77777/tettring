<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Калькулятор кода печати</title>
<style>
  body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; }
  select, button, input { font-size: 1em; margin: 6px 0; padding: 6px; }
  .result { margin-top: 15px; font-weight: bold; font-size: 1.2em; }
</style>
</head>
<body>
<h2>Калькулятор числового кода печати</h2>

<label for="glyphCount">Количество тэттраглифов:</label>
<input type="number" id="glyphCount" min="1" max="21" value="3" onchange="renderGlyphSelectors()">

<div id="selectors"></div>
<button onclick="calculateCode()">Рассчитать код</button>

<div class="result" id="result"></div>

<script>
const glyphs = [
  ["Эль Аталар", 1], ["Эль Ви-Шах", 2], ["Эль Нере-Ар", 3], ["Эль Ви-Нар", 4],
  ["Эль Эн-Инь-О", 5], ["Эль Ра-Дам", 6], ["Эль Муд-Рам", 7], ["Эль Мун-Ио", 8],
  ["Эль Мар-Кам", 9], ["Эль Рэ-Тан", 10], ["Эль Ке-Тар", 11], ["Эль Ок-Улос", 12],
  ["Эль Мана-Рат", 13], ["Эль Хот-Та", 14], ["Эль Ле-Дар", 15], ["Эль Аму", 16],
  ["Эль Прай-Я", 17], ["Эль Кар", 18], ["Эль Ошта-Лар", 19], ["Эль Су-Ни-Я", 20],
  ["Эль Ра", 21]
];

function renderGlyphSelectors() {
  const count = parseInt(document.getElementById("glyphCount").value, 10);
  const container = document.getElementById("selectors");

  // сохраняем предыдущие выборы при смене количества
  const prev = Array.from(container.querySelectorAll("select")).map(s => s.value);

  container.innerHTML = "";
  for (let i = 0; i < count; i++) {
    const sel = document.createElement("select");
    sel.id = `gate-${i+1}`;

    // Плейсхолдер "Врата №X"
    const placeholder = document.createElement("option");
    placeholder.value = "";
    placeholder.textContent = `— Врата №${i+1}: выберите тэттраглиф —`;
    placeholder.disabled = true;
    placeholder.selected = true;
    sel.appendChild(placeholder);

    // Список из 21 тэттраглифа
    glyphs.forEach(([name, code]) => {
      const opt = document.createElement("option");
      opt.value = code;
      opt.textContent = `${name} (${code})`;
      sel.appendChild(opt);
    });

    // вернуть прошлый выбор, если он был
    if (prev[i]) sel.value = prev[i];

    container.appendChild(sel);
    container.appendChild(document.createElement("br"));
  }
}

function reduceCode(sum) {
  while (sum > 10) {
    sum = sum.toString().split("").reduce((a, b) => a + +b, 0);
  }
  if (sum === 1) sum = 10;
  return sum;
}

function calculateCode() {
  const selects = document.querySelectorAll("#selectors select");
  let total = 0;
  let missing = false;

  selects.forEach(sel => {
    const val = parseInt(sel.value, 10);
    if (isNaN(val)) missing = true; else total += val;
  });

  const out = document.getElementById("result");
  if (missing) {
    out.textContent = "Пожалуйста, выберите тэттраглиф для всех врат.";
    return;
  }

  const finalCode = reduceCode(total);
  out.textContent = `Финальный числовой код: ${finalCode}`;
}

renderGlyphSelectors();
</script>
</body>
</html>